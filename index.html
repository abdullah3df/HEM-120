<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HE Cut Pro v3 — قص الجناح + وزن القطعة</title>

  <!-- Tailwind عبر CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
    html,body{font-family:Cairo,system-ui,ui-sans-serif;}
    svg,svg *{user-select:none}
    body{
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.2), transparent 55%),
        radial-gradient(circle at bottom right, rgba(129,140,248,0.25), #020617);
      min-height:100vh;
    }
    .glass {
      background: radial-gradient(circle at top, rgba(148,163,184,0.18), rgba(15,23,42,0.9));
      backdrop-filter: blur(18px);
    }
  </style>
</head>
<body class="text-slate-100">

  <!-- شريط علوي -->
  <header class="border-b border-slate-800/60 bg-slate-900/80 backdrop-blur sticky top-0 z-20">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
      <div>
        <h1 class="text-xl sm:text-2xl font-bold tracking-tight">
          HE Cut Pro <span class="text-sky-400 text-base align-middle">v3</span>
        </h1>
        <p class="text-xs sm:text-sm text-slate-400 mt-0.5">
          حاسبة قص الجناح لمقاطع HEA / HEB / HEM + وزن القطعة — منظر أمامي فقط
        </p>
      </div>
      <div class="text-[10px] sm:text-xs text-slate-300 text-left leading-snug">
        القص من قطعتين:<br>
        Δ<sub>total</sub> = b · tan(θ)<br>
        Δ<sub>لكل قطعة</sub> = Δ<sub>total</sub> / 2<br>
        طول القطعة L ثابت، القص لا يغيّر الطول
      </div>
    </div>
  </header>

  <!-- محتوى -->
  <main class="max-w-6xl mx-auto px-4 py-6 sm:py-10 grid grid-cols-1 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,1.1fr)] gap-6">

    <!-- لوحة الإعدادات والنتائج -->
    <section class="glass rounded-2xl shadow-xl shadow-sky-950/50 border border-slate-700/70 p-4 sm:p-5">
      <div class="flex items-center justify-between gap-2 mb-4">
        <h2 class="font-semibold text-lg sm:text-xl flex items-center gap-2">
          <span class="inline-flex h-6 w-6 rounded-full bg-sky-500/20 border border-sky-400/50 items-center justify-center text-[11px]">
            1
          </span>
          الإعدادات &amp; الحساب (قص + وزن)
        </h2>
        <span class="text-[11px] text-slate-400 hidden sm:inline">
          اختر المقطع، الزاوية، والطول — تحصل على مقدار القص لكل قطعة والوزن
        </span>
      </div>

      <div class="grid grid-cols-2 gap-3 text-sm">
        <!-- سلسلة -->
        <label class="col-span-2 text-slate-300 flex items-center justify-between">
          سلسلة المقطع (Series)
          <span class="text-[10px] text-sky-300/80">HEA / HEB / HEM</span>
        </label>
        <select id="series"
                class="col-span-2 rounded-lg border border-slate-700 bg-slate-900/70 px-3 py-2 focus:outline-none focus:ring-1 focus:ring-sky-400">
          <option value="HEA">HEA</option>
          <option value="HEB" selected>HEB</option>
          <option value="HEM">HEM</option>
        </select>

        <!-- مقاس -->
        <label class="col-span-2 text-slate-300 flex items-center justify-between mt-1">
          المقاس (Size)
          <span class="text-[10px] text-slate-400">HE 100 … HE 400</span>
        </label>
        <select id="size"
                class="col-span-2 rounded-lg border border-slate-700 bg-slate-900/70 px-3 py-2 focus:outline-none focus:ring-1 focus:ring-sky-400"></select>

        <!-- زاوية التجميع -->
        <label class="col-span-2 text-slate-300 flex items-center justify-between mt-1">
          زاوية التجميع θ (درجة)
          <span class="text-[10px] text-slate-400">الزاوية بين القطعتين بعد الجمع</span>
        </label>
        <input id="angle" type="number" min="1" max="45" step="0.5" value="22"
               class="col-span-2 rounded-lg border border-slate-700 bg-slate-900/70 px-3 py-2 focus:outline-none focus:ring-1 focus:ring-sky-400" />

        <!-- طول القطعة -->
        <label class="col-span-2 text-slate-300 flex items-center justify-between mt-1">
          طول القطعة L (mm)
          <span class="text-[10px] text-slate-400">مثلاً 5000 = 5 متر (لوزن القطعة)</span>
        </label>
        <input id="length" type="number" min="100" step="10" value="5000"
               class="col-span-2 rounded-lg border border-slate-700 bg-slate-900/70 px-3 py-2 focus:outline-none focus:ring-1 focus:ring-sky-400" />
      </div>

      <!-- نتائج نصية -->
      <div class="mt-5 rounded-xl border border-slate-700/80 bg-slate-900/70 px-3.5 py-3 text-sm" id="readout">
        <!-- JS هنا -->
      </div>

      <div class="mt-4 flex flex-wrap gap-2">
        <button id="btnReset"
                class="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-xs sm:text-sm border border-slate-600">
          إعادة الضبط (HEB 180 / 22° / 5m)
        </button>
      </div>

      <p class="text-[11px] text-slate-400 mt-3 leading-relaxed">
        <b>تفسير القص:</b> نعتبر أن القص يتم من <b>قطعتين</b> مثل المخططات التي أرسلتها:<br>
        يتم حساب Δ<sub>total</sub> المطلوبة بين خطّي القص، ثم يأخذ كل جناح من كل قطعة
        نصف القيمة: Δ<sub>لكل قطعة</sub> = Δ<sub>total</sub> / 2.  
        تقيس Δ لكل قطعة على حافة الجناح على طول القطعة، وتوصلها مع الطرف الآخر بخط مستقيم وتقص.
        طول القطعة L يبقى كما هو.
      </p>
    </section>

    <!-- الشكل الأمامي الاحترافي -->
    <section class="glass rounded-2xl shadow-xl shadow-sky-950/50 border border-slate-700/70 p-4 sm:p-5 flex flex-col">
      <div class="flex items-center justify-between gap-2 mb-4">
        <h2 class="font-semibold text-lg sm:text-xl flex items-center gap-2">
          <span class="inline-flex h-6 w-6 rounded-full bg-emerald-500/20 border border-emerald-400/60 items-center justify-center text-[11px]">
            2
          </span>
          الوجه الأمامي للمقطع — عرض بصري
        </h2>
        <span class="text-[11px] text-slate-400 hidden sm:inline">
          جناح علوي، جناح سفلي، عمود (web)، وخط قص أحمر بزاوية θ (شكل توضيحي)
        </span>
      </div>

      <div class="flex-1 border border-slate-700/70 rounded-2xl bg-slate-900/70 px-3 py-4 flex items-center justify-center">
        <div id="frontWrapper"></div>
      </div>

      <div class="grid grid-cols-2 gap-3 text-[11px] text-slate-400 mt-4">
        <div class="flex items-center gap-2">
          <span class="inline-block h-3 w-3 rounded-sm bg-slate-400/80"></span>
          الجناحان (علوي / سفلي)
        </div>
        <div class="flex items-center gap-2">
          <span class="inline-block h-3 w-3 rounded-sm bg-slate-300"></span>
          العمود (web)
        </div>
        <div class="flex items-center gap-2">
          <span class="inline-block h-3 w-3 rounded-sm bg-red-500"></span>
          خط القص على الجناح العلوي (رمزي)
        </div>
        <div class="flex items-center gap-2">
          <span class="inline-block h-3 w-3 rounded-full border border-sky-400"></span>
          الرسم تمثيلي، الأبعاد العددية مكتوبة في الجدول على اليسار
        </div>
      </div>
    </section>

  </main>

  <footer class="max-w-6xl mx-auto px-4 pb-6 text-[11px] text-slate-500 flex flex-wrap items-center justify-between gap-2">
    <span>HE Cut Pro v3 — قص الجناح + وزن (index.html)</span>
    <span>للتنفيذ العملي: اعتمد دائمًا كتالوج المقاطع وتعليمات الورشة.</span>
  </footer>

  <!-- المنطق -->
  <script>
    // بيانات تقريبية: عرض الجناح b (mm) + وزن المتر kg/m
    const HE_DATA = {
      HEA: {
        100:{b:100, kgpm:17.0},
        120:{b:120, kgpm:20.3},
        140:{b:140, kgpm:25.1},
        160:{b:160, kgpm:31.0},
        180:{b:180, kgpm:36.2},
        200:{b:200, kgpm:43.1},
        220:{b:220, kgpm:51.5},
        240:{b:240, kgpm:61.5},
        260:{b:260, kgpm:69.5},
        280:{b:280, kgpm:77.8},
        300:{b:300, kgpm:90.0},
        320:{b:300, kgpm:99.5},
        340:{b:300, kgpm:107},
        360:{b:300, kgpm:114},
        400:{b:300, kgpm:127}
      },
      HEB: {
        100:{b:100, kgpm:20.8},
        120:{b:120, kgpm:27.2},
        140:{b:140, kgpm:34.4},
        160:{b:160, kgpm:43.4},
        180:{b:180, kgpm:52.2},
        200:{b:200, kgpm:62.5},
        220:{b:220, kgpm:72.8},
        240:{b:240, kgpm:84.8},
        260:{b:260, kgpm:94.8},
        280:{b:280, kgpm:105},
        300:{b:300, kgpm:119},
        320:{b:300, kgpm:129},
        340:{b:300, kgpm:137},
        360:{b:300, kgpm:145},
        400:{b:300, kgpm:158}
      },
      HEM: {
        100:{b:120, kgpm:42.6},
        120:{b:120, kgpm:53.1},
        140:{b:140, kgpm:64.4},
        160:{b:160, kgpm:77.6},
        180:{b:180, kgpm:90.6},
        200:{b:200, kgpm:105},
        220:{b:220, kgpm:120},
        240:{b:240, kgpm:160},
        260:{b:260, kgpm:176},
        280:{b:260, kgpm:192},
        300:{b:300, kgpm:242},
        320:{b:300, kgpm:250},
        340:{b:300, kgpm:253},
        360:{b:300, kgpm:255},
        400:{b:300, kgpm:261}
      }
    };

    const $series = document.getElementById('series');
    const $size   = document.getElementById('size');
    const $angle  = document.getElementById('angle');
    const $length = document.getElementById('length');
    const $readout= document.getElementById('readout');
    const $frontWrapper = document.getElementById('frontWrapper');
    const $btnReset = document.getElementById('btnReset');

    function populateSizes() {
      const s = $series.value;
      const sizes = Object.keys(HE_DATA[s]).map(Number).sort((a,b)=>a-b);
      $size.innerHTML = sizes
        .map(v => `<option value="${v}" ${v===180?'selected':''}>${v}</option>`)
        .join('');
    }

    function calc() {
      const s   = $series.value;
      const sz  = Number($size.value);
      let angDeg= Number($angle.value);
      let Lmm   = Number($length.value);

      if (angDeg < 1)  angDeg = 1;
      if (angDeg > 45) angDeg = 45;
      $angle.value = angDeg;

      if (!Lmm || Lmm < 100) Lmm = 100;
      $length.value = Lmm;

      const data = HE_DATA[s][sz] || {b:180, kgpm:0};
      const b    = data.b;
      const kgpm = data.kgpm;

      // زاوية بالراديان
      const theta = angDeg * Math.PI / 180;

      // Δ الكلية المطلوبة بين خطي القص (لو نظرت من الأعلى): b * tan(θ)
      const deltaTotal = b * Math.tan(theta);     // mm

      // القص الفعلي على كل قطعة (نصف القيمة) لأننا نقطّع من قطعتين
      const deltaEach  = deltaTotal / 2;          // mm لكل قطعة

      const Lm   = Lmm / 1000;        // طول بالمتر
      const totalKg = kgpm * Lm;      // وزن تقريبي

      renderReadout({s, sz, b, kgpm, Lmm, Lm, totalKg, angDeg, deltaTotal, deltaEach});
      renderFront({b, sz, s, angDeg});
    }

    function renderReadout({s, sz, b, kgpm, Lmm, Lm, totalKg, angDeg, deltaTotal, deltaEach}) {
      const kgpmText  = kgpm > 0 ? kgpm.toFixed(1) + " kg/m" : "غير متوفر في الجدول";
      const weightTxt = kgpm > 0 ? totalKg.toFixed(2) + " kg" : "—";

      $readout.innerHTML = `
        <div class="text-sky-300 text-xs mb-1">معلومات المقطع والقص والوزن</div>
        <div class="grid grid-cols-2 gap-x-3 gap-y-1">
          <div>البروفايل:</div>
          <div class="text-right"><b>${s} ${sz}</b></div>

          <div>عرض الجناح b (تقريبي):</div>
          <div class="text-right"><b>${b.toFixed(0)} mm</b></div>

          <div>زاوية التجميع θ بين القطعتين:</div>
          <div class="text-right"><b>${angDeg.toFixed(1)}°</b></div>

          <div>طول القطعة L (قبل وبعد القص):</div>
          <div class="text-right"><b>${Lmm.toFixed(0)} mm</b> ≈ <b>${Lm.toFixed(3)} m</b></div>

          <div>القص الكلّي المطلوب Δ<sub>total</sub> (بين القطعتين):</div>
          <div class="text-right text-amber-300"><b>${deltaTotal.toFixed(1)} mm</b></div>

          <div>القص على كل قطعة Δ لكل جناح:</div>
          <div class="text-right text-emerald-300"><b>${deltaEach.toFixed(1)} mm</b></div>

          <div>وزن المتر الواحد من الجدول:</div>
          <div class="text-right"><b>${kgpmText}</b></div>

          <div>وزن القطعة التقريبي:</div>
          <div class="text-right"><b>${weightTxt}</b></div>
        </div>
        <div class="text-[10px] text-slate-400 mt-2">
          طريقة الاستخدام في الورشة: علّم نقطة على حافة الجناح من جهة واحدة، تبعد Δ لكل قطعة (mm) على طول
          الجناح، ثم أوصل هذه النقطة مع الطرف الآخر للجناح بخط مستقيم — هذا هو خط القص. نفّذ نفس القيمة
          بالعكس على القطعة الثانية. بعد الجمع، تحصل على زاوية ≈ θ بين القطعتين. طول القطعة لا يتغيّر.
        </div>
      `;
    }

    // رسم وجه أمامي احترافي لمقطع H مع خط قص رمزي على الجناح العلوي
    function renderFront({b, sz, s, angDeg}) {
      const widthPx  = 320;
      const heightPx = 260;
      const paddingY = 30;

      const midX   = widthPx / 2;
      const topY   = paddingY;
      const botY   = heightPx - paddingY;

      const nominalH = sz;
      const normH    = 200;
      const scaleH   = Math.min(1.1, Math.max(0.7, nominalH / 220));
      const profileHeight = normH * scaleH;

      const centerY = (topY + botY) / 2;
      const topFlangeY = centerY - profileHeight / 2;
      const botFlangeY = centerY + profileHeight / 2;

      const flangeTh = Math.max(18, Math.min(32, profileHeight * 0.18));
      const webTh    = Math.max(12, Math.min(26, profileHeight * 0.12));

      const halfFlangeSpan = 70 + (b - 180) * 0.25;
      const flangeLeftInner  = midX - halfFlangeSpan;
      const flangeRightInner = midX + halfFlangeSpan;

      const baseLength = 90;
      const extra = (angDeg / 45) * 20;
      const cutLength = baseLength + extra;
      const rad = angDeg * Math.PI / 180;
      const dx = cutLength * Math.cos(rad);
      const dy = cutLength * Math.sin(rad);

      const cutX1 = flangeRightInner;
      const cutY1 = topFlangeY;
      const cutX2 = flangeRightInner - dx;
      const cutY2 = topFlangeY + dy;

      const svg = `
        <svg width="${widthPx}" height="${heightPx}" viewBox="0 0 ${widthPx} ${heightPx}">
          <defs>
            <linearGradient id="metalGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#cbd5f5" />
              <stop offset="40%" stop-color="#e5e7eb" />
              <stop offset="70%" stop-color="#9ca3af" />
              <stop offset="100%" stop-color="#6b7280" />
            </linearGradient>
            <linearGradient id="webGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stop-color="#e5e7eb" />
              <stop offset="100%" stop-color="#9ca3af" />
            </linearGradient>
            <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
              <feDropShadow dx="0" dy="6" stdDeviation="6" flood-color="#020617" flood-opacity="0.8" />
            </filter>
          </defs>

          <g filter="url(#shadow)">
            <!-- الجناح العلوي -->
            <rect x="${flangeLeftInner}" y="${topFlangeY}"
                  width="${(flangeRightInner - flangeLeftInner)}"
                  height="${flangeTh}"
                  fill="url(#metalGrad)" stroke="#94a3b8" stroke-width="1" />

            <!-- الجناح السفلي -->
            <rect x="${flangeLeftInner}" y="${botFlangeY - flangeTh}"
                  width="${(flangeRightInner - flangeLeftInner)}"
                  height="${flangeTh}"
                  fill="url(#metalGrad)" stroke="#94a3b8" stroke-width="1" />

            <!-- العمود (web) -->
            <rect x="${midX - webTh/2}" y="${topFlangeY + flangeTh}"
                  width="${webTh}"
                  height="${(botFlangeY - flangeTh) - (topFlangeY + flangeTh)}"
                  fill="url(#webGrad)" stroke="#94a3b8" stroke-width="1" />
          </g>

          <!-- خط القص الأحمر (رمزي فقط) -->
          <line x1="${cutX1}" y1="${cutY1}"
                x2="${cutX2}" y2="${cutY2}"
                stroke="#f97373" stroke-width="3" />

          <polygon points="
              ${cutX2},${cutY2}
              ${cutX2 - 6},${cutY2 - 4}
              ${cutX2 - 6},${cutY2 + 4}
            " fill="#f97373" />

          <!-- زاوية القص -->
          <text x="${cutX2 - 4}" y="${cutY2 + 16}"
                font-size="11" fill="#fda4af" font-weight="600" text-anchor="end">
            θ ≈ ${angDeg.toFixed(1)}°
          </text>

          <!-- عنوان المقطع -->
          <text x="${midX}" y="${topFlangeY - 12}"
                font-size="13" fill="#e5e7eb" text-anchor="middle" font-weight="600">
            ${s} ${sz}
          </text>

          <text x="${midX}" y="${botFlangeY + 14}" font-size="10" fill="#cbd5f5" text-anchor="middle">
            منظر أمامي رمزي لمقطع H
          </text>
        </svg>
      `;
      $frontWrapper.innerHTML = svg;
    }

    // أحداث
    [$series, $size, $angle, $length].forEach(el => {
      el.addEventListener('input', calc);
    });

    $btnReset.addEventListener('click', () => {
      $series.value = 'HEB';
      populateSizes();
      $size.value = '180';
      $angle.value = 22;
      $length.value = 5000;
      calc();
    });

    // تهيئة أولية
    populateSizes();
    document.getElementById('size').value = '180';
    calc();
  </script>
</body>
</html>
